[gd_scene load_steps=4 format=3 uid="uid://bqm5fu48btky6"]

[ext_resource type="FontFile" uid="uid://c2jlc3nt8y38q" path="res://assets/font/atlas-0.png" id="2_bg6gx"]

[sub_resource type="GDScript" id="GDScript_sgcln"]
script/source = "extends CanvasItem

enum IndicatorSpecial {
    NONE, CONN, FPS
}

@export var flag: int = 0
@export var special: IndicatorSpecial = IndicatorSpecial.NONE
@export var color: Color = Color.CYAN
@export var text: String = \"WH\"

func _ready() -> void:
    %label.text = text

func _process(delta: float) -> void:
    match special:
        IndicatorSpecial.NONE:
            var on: bool = PicoVideoStreamer.instance.current_custom_data[0] & flag
            %light.modulate = color if on else Color.BLACK
        IndicatorSpecial.CONN:
            if PicoVideoStreamer.instance.tcp:
                match PicoVideoStreamer.instance.tcp.get_status():
                    StreamPeerTCP.STATUS_NONE:
                        %light.modulate = Color.BLACK
                    StreamPeerTCP.STATUS_CONNECTED:
                        %light.modulate = Color(\"#00e436\")
                    StreamPeerTCP.STATUS_CONNECTING, StreamPeerTCP.STATUS_ERROR:
                        %light.modulate = Color(\"#ff2839\")
            else:
                %light.modulate = Color(\"#ff2839\")
        IndicatorSpecial.FPS:
            if Time.get_ticks_msec() < 2000:
                %light.modulate = color
            else:
                var fps = Engine.get_frames_per_second()
                if fps > 50:
                    %light.modulate = Color(\"#00e436\")
                elif fps > 30:
                    %light.modulate = Color(\"#ffec27\")
                else:
                    %light.modulate = Color(\"#ff2839\")
"

[sub_resource type="LabelSettings" id="LabelSettings_u2b24"]
font = ExtResource("2_bg6gx")
font_size = 5
font_color = Color(0.760784, 0.764706, 0.780392, 1)
outline_size = 4
outline_color = Color(0, 0, 0, 1)
shadow_size = 0

[node name="indicator" type="Node2D"]
script = SubResource("GDScript_sgcln")

[node name="bg" type="Polygon2D" parent="."]
color = Color(0.0470588, 0.0705882, 0.137255, 1)
polygon = PackedVector2Array(0, 0, 0, -1, 2, -1, 2, 0, 3, 0, 3, 2, 2, 2, 2, 3, 0, 3, 0, 2, -1, 2, -1, 0)
uv = PackedVector2Array(427, -21, 310, -5)

[node name="light" type="Polygon2D" parent="."]
unique_name_in_owner = true
polygon = PackedVector2Array(0, 0, 2, 0, 2, 2, 0, 2)

[node name="label" type="Label" parent="."]
unique_name_in_owner = true
offset_left = 5.0
offset_top = -1.0
offset_right = 206.0
offset_bottom = 18.0
text = "what"
label_settings = SubResource("LabelSettings_u2b24")
